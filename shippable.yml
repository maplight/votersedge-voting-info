language: python                                                 

build:                                                  

  ci:
    - cd tools/scripts && ./compileJSON.py
    - cd ../../
    #- if [ -n "$(git status --porcelain)" ]; then echo "*** Files have been updated. ***"; git config --global user.email "shane@maplight.org" && git config --global user.name "shaned-maplight" && git add * && git commit -m "latest voter info updates" && git push origin master && aws s3 cp json s3://votersedge-voting-info-static/json --grants read=uri=http://acs.amazonaws.com/groups/global/AllUsers --recursive --include "*.*"; else echo "*** Files have not changed. Nothing to commit and upload. ***"; fi
    - if [ -n "$(git status --porcelain)" ]; then 
        echo "*** Files have been updated. ***";
        git add *;
        git commit -m "[skip ci] latest voter info updates";
        ssh-agent bash -c "ssh-add ~/keys/id_${JOB_ID}; git push origin master";
        aws s3 cp json s3://votersedge-voting-info-static/json --grants read=uri=http://acs.amazonaws.com/groups/global/AllUsers --recursive --include "*.*";
      else 
        echo "*** Files have not changed. Nothing to commit and upload. ***";
      fi

integrations:
  key:
    - integrationName: PORTLANDIA_SSH_KEY
      type: ssh-key
